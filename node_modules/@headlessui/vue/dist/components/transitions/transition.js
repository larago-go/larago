import{computed as V,defineComponent as U,h as K,inject as H,onMounted as C,onUnmounted as k,provide as F,ref as p,watch as ae,watchEffect as w,normalizeClass as ie}from"vue";import{useId as le}from'../../hooks/use-id.js';import{match as B}from'../../utils/match.js';import{env as se}from'../../utils/env.js';import{Features as oe,omit as ue,render as z,RenderStrategy as m}from'../../utils/render.js';import{Reason as $,transition as q}from'./utils/transition.js';import{dom as G}from'../../utils/dom.js';import{useOpenClosedProvider as fe,State as u,useOpenClosed as de,hasOpenClosed as ve}from'../../internal/open-closed.js';function T(e=""){return e.split(" ").filter(t=>t.trim().length>1)}let O=Symbol("TransitionContext");var pe=(l=>(l.Visible="visible",l.Hidden="hidden",l))(pe||{});function me(){return H(O,null)!==null}function Te(){let e=H(O,null);if(e===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return e}function ge(){let e=H(R,null);if(e===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return e}let R=Symbol("NestingContext");function x(e){return"children"in e?x(e.children):e.value.filter(({state:t})=>t==="visible").length>0}function J(e){let t=p([]),l=p(!1);C(()=>l.value=!0),k(()=>l.value=!1);function s(n,r=m.Hidden){let i=t.value.findIndex(({id:f})=>f===n);i!==-1&&(B(r,{[m.Unmount](){t.value.splice(i,1)},[m.Hidden](){t.value[i].state="hidden"}}),!x(t)&&l.value&&(e==null||e()))}function g(n){let r=t.value.find(({id:i})=>i===n);return r?r.state!=="visible"&&(r.state="visible"):t.value.push({id:n,state:"visible"}),()=>s(n,m.Unmount)}return{children:t,register:g,unregister:s}}let Q=oe.RenderStrategy,he=U({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(e,{emit:t,attrs:l,slots:s,expose:g}){let n=p(0);function r(){n.value|=u.Opening,t("beforeEnter")}function i(){n.value&=~u.Opening,t("afterEnter")}function f(){n.value|=u.Closing,t("beforeLeave")}function S(){n.value&=~u.Closing,t("afterLeave")}if(!me()&&ve())return()=>K(Se,{...e,onBeforeEnter:r,onAfterEnter:i,onBeforeLeave:f,onAfterLeave:S},s);let d=p(null),a=p("visible"),W=V(()=>e.unmount?m.Unmount:m.Hidden);g({el:d,$el:d});let{show:h,appear:N}=Te(),{register:A,unregister:L}=ge(),D={value:!0},c=le(),b={value:!1},I=J(()=>{!b.value&&a.value!=="hidden"&&(a.value="hidden",L(c),S())});C(()=>{let o=A(c);k(o)}),w(()=>{if(W.value===m.Hidden&&!!c){if(h&&a.value!=="visible"){a.value="visible";return}B(a.value,{["hidden"]:()=>L(c),["visible"]:()=>A(c)})}});let P=T(e.enter),j=T(e.enterFrom),X=T(e.enterTo),M=T(e.entered),Y=T(e.leave),Z=T(e.leaveFrom),ee=T(e.leaveTo);C(()=>{w(()=>{if(a.value==="visible"){let o=G(d);if(o instanceof Comment&&o.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function te(o){let y=D.value&&!N.value,v=G(d);!v||!(v instanceof HTMLElement)||y||(b.value=!0,h.value&&r(),h.value||f(),o(h.value?q(v,P,j,X,M,E=>{b.value=!1,E===$.Finished&&i()}):q(v,Y,Z,ee,M,E=>{b.value=!1,E===$.Finished&&(x(I)||(a.value="hidden",L(c),S()))})))}return C(()=>{ae([h],(o,y,v)=>{te(v),D.value=!1},{immediate:!0})}),F(R,I),fe(V(()=>B(a.value,{["visible"]:u.Open,["hidden"]:u.Closed})|n.value)),()=>{let{appear:o,show:y,enter:v,enterFrom:E,enterTo:Ce,entered:be,leave:ye,leaveFrom:Ee,leaveTo:Ve,..._}=e,ne={ref:d},re={..._,...N&&h&&se.isServer?{class:ie([_.class,...P,...j])}:{}};return z({theirProps:re,ourProps:ne,slot:{},slots:s,attrs:l,features:Q,visible:a.value==="visible",name:"TransitionChild"})}}}),ce=he,Se=U({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(e,{emit:t,attrs:l,slots:s}){let g=de(),n=V(()=>e.show===null&&g!==null?(g.value&u.Open)===u.Open:e.show);w(()=>{if(![!0,!1].includes(n.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let r=p(n.value?"visible":"hidden"),i=J(()=>{r.value="hidden"}),f=p(!0),S={show:n,appear:V(()=>e.appear||!f.value)};return C(()=>{w(()=>{f.value=!1,n.value?r.value="visible":x(i)||(r.value="hidden")})}),F(R,i),F(O,S),()=>{let d=ue(e,["show","appear","unmount","onBeforeEnter","onBeforeLeave","onAfterEnter","onAfterLeave"]),a={unmount:e.unmount};return z({ourProps:{...a,as:"template"},theirProps:{},slot:{},slots:{...s,default:()=>[K(ce,{onBeforeEnter:()=>t("beforeEnter"),onAfterEnter:()=>t("afterEnter"),onBeforeLeave:()=>t("beforeLeave"),onAfterLeave:()=>t("afterLeave"),...l,...a,...d},s.default)]},attrs:{},features:Q,visible:r.value==="visible",name:"Transition"})}}});export{he as TransitionChild,Se as TransitionRoot};
