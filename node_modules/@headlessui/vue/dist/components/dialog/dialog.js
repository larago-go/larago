import{computed as i,defineComponent as y,h as v,inject as j,nextTick as Z,onMounted as I,onUnmounted as ee,provide as te,ref as D,watchEffect as le}from"vue";import{render as b,Features as K}from'../../utils/render.js';import{Keys as ae}from'../../keyboard.js';import{useId as O}from'../../hooks/use-id.js';import{FocusTrap as C}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as oe}from'../../hooks/use-inert-others.js';import{Portal as N,PortalGroup as re}from'../portal/portal.js';import{StackMessage as _,useStackProvider as ne}from'../../internal/stack-context.js';import{match as U}from'../../utils/match.js';import{ForcePortalRoot as M}from'../../internal/portal-force-root.js';import{Description as ie,useDescriptions as ue}from'../description/description.js';import{dom as Y}from'../../utils/dom.js';import{useOpenClosed as se,State as T}from'../../internal/open-closed.js';import{useOutsideClick as pe}from'../../hooks/use-outside-click.js';import{getOwnerDocument as fe}from'../../utils/owner.js';import{useEventListener as de}from'../../hooks/use-event-listener.js';import{Hidden as ce,Features as ge}from'../../internal/hidden.js';import{useDocumentOverflowLockedEffect as me}from'../../hooks/document-overflow/use-document-overflow.js';var ve=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(ve||{});let L=Symbol("DialogContext");function P(t){let r=j(L,null);if(r===null){let e=new Error(`<${t} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,P),e}return r}let k="DC8F892D-2EBD-447C-A4C8-A03058436FF4",je=y({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:k},initialFocus:{type:Object,default:null},id:{type:String,default:()=>`headlessui-dialog-${O()}`}},emits:{close:t=>!0},setup(t,{emit:r,attrs:e,slots:u,expose:n}){var $;let l=D(!1);I(()=>{l.value=!0});let s=D(0),f=se(),m=i(()=>t.open===k&&f!==null?(f.value&T.Open)===T.Open:t.open),w=D(new Set),c=D(null),A=D(null),x=i(()=>fe(c));if(n({el:c,$el:c}),!(t.open!==k||f!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof m.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${m.value===k?void 0:t.open}`);let g=i(()=>l.value&&m.value?0:1),F=i(()=>g.value===0),R=i(()=>s.value>1),q=j(L,null)!==null,G=i(()=>R.value?"parent":"leaf"),B=i(()=>f!==null?(f.value&T.Closing)===T.Closing:!1),V=i(()=>!R.value||B.value?!1:F.value);oe(c,V),ne({type:"Dialog",enabled:i(()=>g.value===0),element:c,onUpdate:(a,o,d)=>{if(o==="Dialog")return U(a,{[_.Add](){w.value.add(d),s.value+=1},[_.Remove](){w.value.delete(d),s.value-=1}})}});let z=ue({name:"DialogDescription",slot:i(()=>({open:m.value}))}),E=D(null),S={titleId:E,panelRef:D(null),dialogState:g,setTitleId(a){E.value!==a&&(E.value=a)},close(){r("close",!1)}};te(L,S);function H(){var o,d,h;return[...Array.from((d=(o=x.value)==null?void 0:o.querySelectorAll("html > *, body > *, [data-headlessui-portal]"))!=null?d:[]).filter(p=>!(p===document.body||p===document.head||!(p instanceof HTMLElement)||p.contains(Y(A))||S.panelRef.value&&p.contains(S.panelRef.value))),(h=S.panelRef.value)!=null?h:c.value]}let J=i(()=>!(!F.value||R.value));pe(()=>H(),(a,o)=>{S.close(),Z(()=>o==null?void 0:o.focus())},J);let Q=i(()=>!(R.value||g.value!==0));de(($=x.value)==null?void 0:$.defaultView,"keydown",a=>{!Q.value||a.defaultPrevented||a.key===ae.Escape&&(a.preventDefault(),a.stopPropagation(),S.close())});let W=i(()=>!(B.value||g.value!==0||q));return me(x,W,a=>{var o;return{containers:[...(o=a.containers)!=null?o:[],H]}}),le(a=>{if(g.value!==0)return;let o=Y(c);if(!o)return;let d=new IntersectionObserver(h=>{for(let p of h)p.boundingClientRect.x===0&&p.boundingClientRect.y===0&&p.boundingClientRect.width===0&&p.boundingClientRect.height===0&&S.close()});d.observe(o),a(()=>d.disconnect())}),()=>{let{id:a,open:o,initialFocus:d,...h}=t,p={...e,ref:c,id:a,role:"dialog","aria-modal":g.value===0?!0:void 0,"aria-labelledby":E.value,"aria-describedby":z.value},X={open:g.value===0};return v(M,{force:!0},()=>[v(N,()=>v(re,{target:c.value},()=>v(M,{force:!1},()=>v(C,{initialFocus:d,containers:w,features:F.value?U(G.value,{parent:C.features.RestoreFocus,leaf:C.features.All&~C.features.FocusLock}):C.features.None},()=>b({ourProps:p,theirProps:h,slot:X,attrs:e,slots:u,visible:g.value===0,features:K.RenderStrategy|K.Static,name:"Dialog"}))))),v(ce,{features:ge.Hidden,ref:A})])}}}),Ke=y({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-overlay-${O()}`}},setup(t,{attrs:r,slots:e}){let u=P("DialogOverlay");function n(l){l.target===l.currentTarget&&(l.preventDefault(),l.stopPropagation(),u.close())}return()=>{let{id:l,...s}=t;return b({ourProps:{id:l,"aria-hidden":!0,onClick:n},theirProps:s,slot:{open:u.dialogState.value===0},attrs:r,slots:e,name:"DialogOverlay"})}}}),Ne=y({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-backdrop-${O()}`}},inheritAttrs:!1,setup(t,{attrs:r,slots:e,expose:u}){let n=P("DialogBackdrop"),l=D(null);return u({el:l,$el:l}),I(()=>{if(n.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let{id:s,...f}=t,m={id:s,ref:l,"aria-hidden":!0};return v(M,{force:!0},()=>v(N,()=>b({ourProps:m,theirProps:{...r,...f},slot:{open:n.dialogState.value===0},attrs:r,slots:e,name:"DialogBackdrop"})))}}}),_e=y({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-panel-${O()}`}},setup(t,{attrs:r,slots:e,expose:u}){let n=P("DialogPanel");u({el:n.panelRef,$el:n.panelRef});function l(s){s.stopPropagation()}return()=>{let{id:s,...f}=t,m={id:s,ref:n.panelRef,onClick:l};return b({ourProps:m,theirProps:f,slot:{open:n.dialogState.value===0},attrs:r,slots:e,name:"DialogPanel"})}}}),Ue=y({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"},id:{type:String,default:()=>`headlessui-dialog-title-${O()}`}},setup(t,{attrs:r,slots:e}){let u=P("DialogTitle");return I(()=>{u.setTitleId(t.id),ee(()=>u.setTitleId(null))}),()=>{let{id:n,...l}=t;return b({ourProps:{id:n},theirProps:l,slot:{open:u.dialogState.value===0},attrs:r,slots:e,name:"DialogTitle"})}}}),Ye=ie;export{je as Dialog,Ne as DialogBackdrop,Ye as DialogDescription,Ke as DialogOverlay,_e as DialogPanel,Ue as DialogTitle};
